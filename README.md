מדריך מלא: יצירת קומפוננטת צ'אט מותאמת אישית בריטול (Retool)
בשנת 2025 ניתן לבנות קומפוננטות React מותאמות אישית בתוך Retool בקלות. מדריך זה יסביר שלב אחר שלב כיצד ליצור קומפוננטת צ'אט בסגנון וואטסאפ, התומכת בעברית (כיוון ימין-לשמאל), ומשתמשת בנתוני Retool כגון שם הדף הנוכחי ושם המשתמש המחובר לתייג את ההודעות. ההדרכה מבוססת על המדריך מ-ZeroCodez ומקורות רשמיים של Retool, ותכלול קוד מלא, הנחיות התקנה ב-VSCode, וטיפים לדיבאג.
הקדמה: מה נבנה ולמה?
קומפוננטת הצ'אט שלנו תהיה רכיב React שמדמה ממשק הודעות בסגנון WhatsApp. הרכיב ישולב בתוך אפליקציית Retool שלכם ויאפשר תקשורת בזמן אמת ללא שרת צד-שרת (כלומר, ההודעות מנוהלות במצב מקומי של הקומפוננטה). נשתמש בפיצ'ר Custom Component Libraries החדש של Retool (ולא במנגנון הישן), כדי שנוכל לגרור את קומפוננטת הצ'אט כמרכיב לכל דבר בתוך ה-App, לעדכן אותה באמצעות נתוני Retool, ולשלוח ממנה אירועים חזרה לאפליקציה​docs.retool.com​docs.retool.com.
בקומפוננטה נדגים:
תיוג הודעות עם שם משתמש ושם דף – כדי לראות כיצד להעביר נתונים מ-Retool אל הקומפוננטה.


שליחת הודעות מתוך ממשק המשתמש – בעזרת שדה קלט וכפתור "שלח", ללא קריאות API חיצוניות.


התאמה לעברית (RTL) – הן בהיבט מראה (יישור הבועות) והן בתוכן הטקסטואלי (כמו כפתור "שלח" וכיווניות טקסט).


כעת נתחיל בהגדרת סביבת הפיתוח ונעבור לבניית הקומפוננטה.
שלב 1: הקמת סביבת פיתוח לקומפוננטה מותאמת אישית
לפני כתיבת הקוד, נגדיר פרויקט React חדש המבוסס על תבנית הקומפוננטות המותאמות אישית של Retool. תבנית זו מספקת פרויקט React/TypeScript עם כל ההגדרות הנחוצות לחיבור ל-Retool. ודאו שמותקן לכם Node.js ומנהל חבילות (npm או Yarn) ושתוכנת VSCode מותקנת לעריכת הקוד.
1. שיבוט התבנית (Custom Component Template): העתיקו את מאגר התבנית הרשמי של Retool. ניתן לעשות זאת עם הפקודה git clone הבאה (ניתן להחליף את <folder-name> בשם תיקיית הפרויקט החדשה שלכם):
git clone https://github.com/tryretool/custom-component-collection-template.git <folder-name>

פקודה זו תשכפל את קוד התבנית לספרייה מקומית​docs.retool.com. לאחר ההצלחה, היכנסו לתיקייה: cd <folder-name>.
2. התקנת תלותות (npm install): בתיקיית הפרויקט, התקינו את כל חבילות ה-NPM הדרושות בעזרת הפקודה:


npm install

פעולה זו תתקין את React, ספריית התמיכה של Retool לקומפוננטות מותאמות ועוד ספריות שהテンplate מגיעה איתן​docs.retool.com.
3. התחברות לחשבון Retool דרך ה-CLI: כעת נשתמש בכלי שורת הפקודה של Retool שנקרא retool-ccl (ראשי תיבות של Retool Custom Component Library). יש צורך להתחבר עם הכלי כדי לקבל הרשאות לדחוף את הקומפוננטה לחשבון שלכם ב-Retool. לקבלת גישה, צרכו ליצור API Token מתוך חשבון Retool שלכם, עם הרשאות "קריאה וכתיבה" ל-Custom Components (ראו תיעוד Retool ליצירת API key). לאחר שקיבלתם את ה-Token, הריצו בשורת הפקודה:


npx retool-ccl login

יהיה עליכם להזין את ה-API Token כאשר תתבקשו לכך​docs.retool.com. לאחר ההתחברות, הכלי יקשר את סביבת העבודה שלכם לארגון ה-Retool שלכם.
4. אתחול ספריית קומפוננטות חדשה: כעת ניצור "ספרייה" עבור הקומפוננטה המותאמת שלנו. הריצו:


npx retool-ccl init

הכלי ידריך אתכם בבחירת שם לספריית הקומפוננטה (תנו שם ייחודי באנגלית, למשל "ChatComponent") ותיאור אופציונלי. הפקודה תעדכן את קובץ package.json עם שם הספרייה שלכם ותגדיר אותה בשרת Retool שלכם​docs.retool.com. שימו לב: שם הספרייה ושם הקומפוננטה יהיו גלויים בתוך Retool, אז בחרו בשם משמעותי.
5. פתיחת הפרויקט ב-VSCode: פתחו את התיקייה שיצרתם ב-Visual Studio Code. בקוד התבנית תמצאו כנראה קומפוננטת דוגמה בשם "HelloWorld". בשלב הבא נחליף אותה בקומפוננטת הצ'אט שלנו. ניתן להוסיף קובץ חדש או לערוך את הקובץ הקיים. לדוגמה, נוכל ליצור קובץ ChatComponent.tsx תחת src/ ולערוך את src/index.tsx לייצא ממנו את ChatComponent במקום את HelloWorld (ודאו שאתם מייצאים את הקומפוננטה החדשה כדי שתופיע ב-Retool)​community.retool.com.
6. הפעלת מצב פיתוח (Dev Mode): כדי לעבוד בצורה אינטראקטיבית, נפעיל את מצב הפיתוח של Retool עבור הקומפוננטה. בשורת הפקודה בתוך תיקיית הפרויקט, הריצו:


npx retool-ccl dev

פקודה זו תבנה את הקומפוננטה ותסנכרן אוטומטית כל שינוי שתעשו בקוד אל חשבון Retool שלכם (מאפשר פיתוח עם Hot-Reload). כעת, בכל פעם שתשמרו שינויים בקוד, הם יעודכנו באפליקציית Retool ללא צורך בדploi ידני​docs.retool.com.
7. הוספת הקומפוננטה לאפליקציית Retool: פתחו את Retool בדפדפן והיכנסו לאפליקציה שבה תרצו לשלב את הצ'אט (אפשר גם ליצור אפליקציה חדשה לניסוי). עברו ל-App Settings -> Custom Components ובדקו שספריית הקומפוננטות שיצרתם ("ChatComponent" או השם שבחרתם) מופיעה שם ברשימה. כעת, בסרגל הכלים של רכיבי הממשק, חפשו את שם הקומפוננטה (הוא אמור להופיע תחת כותרת הספרייה שלכם). גררו את הקומפוננטה אל הקנבס של האפליקציה. ייתכן שתצטרכו לרענן את הדף בפעם הראשונה כדי שהקומפוננטה החדשה תופיע ברשימת הרכיבים​docs.retool.com. ברגע שהרכיב על המסך, תוכלו לראות אותו (כנראה כריבוע ריק או הודעת ברירת מחדל לפני שהוספנו קוד).
בונוס: עד לסיום הפיתוח, אנו במצב dev. לאחר השלמת הקומפוננטה ובדיקתה, ניתן לבצע דploi של גרסה יציבה לייצור באמצעות הפקודה npx retool-ccl deploy. פקודה זו תדחוף גרסה אימ mutable של הקומפוננטה לשרתי Retool​docs.retool.com. כך תוכלו להשתמש בקומפוננטה באפליקציות פרודקשן או לשתף אותה עם אחרים (אפילו להפוך אותה לציבורית תחת Settings > Custom Component Libraries ב-Retool, אם תרצו).
עריכת קובץ index.tsx
הוספת קובץ ChatComponent.css
יש לוודא שקובץ זה מיובא בקומפוננטה (ראו בשורת import './ChatComponent.css'; בקוד למעלה).

לאחר שכתבנו את הקוד ושמרנו את השינויים, כלי הפיתוח (retool-ccl dev) כבר דואג לעדכן את הקומפוננטה בחשבון Retool שלכם.

בניית שרת WebSocket 
שלבים לבניית שרת WebSocket ב-VS Code
1. הגדרת הסביבה ב-VS Code
התקן את VS Code:
אם עדיין אין לך VS Code, הורד והתקן אותו מ-האתר הרשמי.
התקן Node.js:
ודא ש-Node.js מותקן על המחשב שלך (גרסה 16 ומעלה מומלצת). הורד אותו מ-האתר של Node.js אם הוא לא מותקן.
בדוק את ההתקנה בטרמינל (ב-VS Code או מחוצה לו):
 bash
Copy
node -v
npm -v


פתח פרויקט חדש ב-VS Code:
פתח את VS Code.
לחץ על File > Open Folder וצור תיקייה חדשה לפרויקט (למשל, chat-websocket-server).
פתח טרמינל בתוך VS Code עם Terminal > New Terminal.
אתחל פרויקט Node.js:
בטרמינל, בתוך תיקיית הפרויקט, הרץ:
 bash
Copy
npm init -y


זה יצור קובץ package.json בסיסי.
2. התקנת תלות
התקן את ספריית ws (WebSocket):
הרץ בטרמינל:
 bash
Copy
npm install ws


ws היא ספריית WebSocket קלה ופשוטה ל-Node.js שתאפשר לך ליצור שרת WebSocket.
3. יצירת שרת WebSocket
צור קובץ לשרת:
בתיקיית הפרויקט, צור קובץ בשם server.js.
הסבר על הקוד:
השרת מאזין על פורט 8080 ומטפל בחיבורי WebSocket.
כאשר לקוח מתחבר, הוא נרשם למאגר (clientsByChatId) לפי chat_id.
כאשר לקוח שולח הודעה (עם chat_id, sender_name, ו-message), השרת משדר אותה לכל הלקוחות שמחוברים לאותו chat_id.
ההודעה מועברת בפורמט תואם לקומפוננטה: { sender, text, timestamp }.
השרת מטפל בניתוק לקוחות ומסיר אותם מהמאגר.
הרצת השרת:
בטרמינל, הרץ:
 bash
Copy
node server.js


השרת יתחיל להאזין על ws://localhost:8080.
4. חיבור הקומפוננטה ב-Retool ל-WebSocket
כדי שהקומפוננטה תקבל הודעות חדשות בזמן אמת דרך WebSocket, תצטרך להוסיף קוד JavaScript ב-Retool שמתחבר לשרת ה-WebSocket ומעדכן את previousMessages.
צור קווארי מסוג JavaScript ב-Retool:
עבור ללשונית Queries ב-Retool ולחץ על + New.
בחר JavaScript כסוג הקווארי.
תן לקווארי שם, למשל connectWebSocket.
הסבר:
הקווארי מתחבר לשרת ה-WebSocket בכתובת ws://localhost:8080.
כאשר מתקבלת הודעה, היא מפורשת כ-JSON ומוסיפה ל-previousMessages אם היא תקינה.
ההודעה מוסיפה עם מבנה תואם ל-previousMessages (כולל related_to_id שמבוסס על taskId).
הקווארי שולח את chat_id לשרת בעת החיבור כדי לרשום את הלקוח לצ'אט המתאים.
הפעל את הקווארי בעת טעינת העמוד:
בלשונית Queries, עבור לקווארי connectWebSocket והפעל את האפשרות Run this query on page load.
זה יבטיח שהקומפוננטה מתחברת ל-WebSocket מיד כאשר הדף נטען.
5. שילוב עם הקווארי הקיים
קווארי שליחת הודעות:
ודא שהקווארי insertChatMessage שולח את ההודעה גם למסד הנתונים וגם לשרת ה-WebSocket:


